rules:
    - name: "CPU Usage"
      query: "avg_over_time(cluster:node_cpu:ratio[24h])"
      start: "yesterday midnight"
      end: "today midnight"
      step: "24h"
    - name: "RAM Usage"
      query: "avg_over_time((sum(node_namespace_pod_container:container_memory_working_set_bytes{namespace=\"unihub\", pod=~\"^jupyter.*\", container=\"notebook\"})/sum(machine_memory_bytes))[24:])"
      start: "yesterday midnight"
      end: "today midnight"
      step: "24h"
    - name: "GPU Aquired"
      query: "max_over_time(sum(kube_pod_container_resource_requests{resource=\"nvidia_com_gpu\", container=\"notebook\"})[24h:])"
      start: "yesterday midnight"
      end: "today midnight"
      step: "24h"
    - name: "Percentual of Aquired Cores"
      query: "avg_over_time((sum(cluster:namespace:pod_cpu:active:kube_pod_container_resource_requests{namespace=\"unihub\"}) / sum(machine_cpu_cores))[24h:])"
      start: "yesterday midnight"
      end: "today midnight"
      step: "24h"
    - name: "Percentual of Aquired RAM"
      query: "avg_over_time((sum(cluster:namespace:pod_memory:active:kube_pod_container_resource_limits{namespace=\"unihub\"})/sum(machine_memory_bytes))[24h:])"
      start: "yesterday midnight"
      end: "today midnight"
      step: "24h"
    - name: "Active Users"
      # Ceiled AVG
      query: "ceil(avg_over_time((sum(kube_pod_status_ready{namespace=\"unihub\", pod=~\"^jupyter-.*\"}))[24h:]))"
      # AVG
      # query: "avg_over_time((sum(kube_pod_status_ready{namespace=\"unihub\", pod=~\"^jupyter-.*\"}))[24h:])"
      # MAX
      # query: "max_over_time((sum(kube_pod_status_ready{namespace=\"unihub\", pod=~\"^jupyter-.*\"}))[24h:])"
      start: "yesterday midnight"
      end: "today midnight"
      step: "24h"
